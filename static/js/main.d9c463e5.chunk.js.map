{"version":3,"sources":["constants/api.ts","services/keyService.ts","utils/request.ts","models/KeyModel.ts","models/init.ts","components/List/index.tsx","components/Calc/index.tsx","App.tsx","index.tsx"],"names":["api","getKeys","options","method","baseURL","url","axios","then","res","data","catch","error","erred","KeyModel","keys","loading","keyService","message","this","setModel","timer","List","keyModel","useModel","useState","setData","timeRemain","setRemain","cron","remain","authenticator","timeRemaining","calc","newData","forEach","key","push","name","token","generate","useEffect","a","window","setInterval","clearInterval","columns","title","dataIndex","width","align","render","value","record","index","onClick","text","copy","success","justify","style","maxWidth","flexGrow","bodyStyle","padding","bordered","size","percent","format","dataSource","rowKey","pagination","Calc","inputRef","useRef","setToken","current","input","marginBottom","span","ref","placeholder","onPressEnter","Text","copyable","App","showCalc","setShowCalc","Header","height","Title","color","level","type","Content","overflowY","destroyOnClose","maskClosable","footer","visible","onCancel","ReactDOM","locale","zhCN","document","getElementById"],"mappings":"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","file":"static/js/main.d9c463e5.chunk.js","sourcesContent":["export const mfa_base = 'https://mfa.api.tarocch1.com';\n\nexport const api = {\n  key: '/key',\n};\n","import request from '../utils/request';\nimport { mfa_base, api } from '../constants/api';\n\nexport const getKeys = () => {\n  return request({\n    method: 'get',\n    baseURL: mfa_base,\n    url: api.key,\n  });\n};\n","import axios, { AxiosRequestConfig } from 'axios';\n\nexport default function request(options: AxiosRequestConfig) {\n  return axios(options)\n    .then(res => res.data)\n    .catch(error => {\n      return {\n        erred: true,\n        error,\n      };\n    });\n}\n","import { message } from 'antd';\nimport { keyService } from '../services';\n\ninterface Key {\n  name: string;\n  key: string;\n}\n\nclass KeyModel {\n  keys: Key[] = [];\n  loading = true;\n  async getKeys() {\n    const keys = await keyService.getKeys();\n    if (keys.erred) {\n      message.error('获取密钥失败');\n    } else {\n      this.keys = keys;\n    }\n    this.loading = false;\n  }\n}\n\nexport default KeyModel;\n","import { setModel } from '@tarocch1/use-model';\nimport { KeyModel } from './';\n\nsetModel(KeyModel);\n","import React, { useState, useEffect } from 'react';\nimport { Row, Col, Card, Table, Progress, message } from 'antd';\nimport { ColumnsType } from 'antd/es/table';\nimport { useModel } from '@tarocch1/use-model';\nimport { authenticator } from 'otplib';\nimport copy from 'copy-to-clipboard';\nimport { KeyModel } from '../../models';\n\ninterface DataItem {\n  name: string;\n  token: string;\n}\n\nlet timer = 0;\n\nfunction List() {\n  const keyModel = useModel(KeyModel);\n  const [data, setData] = useState<DataItem[]>([]);\n  const [timeRemain, setRemain] = useState(30);\n\n  const cron = () => {\n    const remain = authenticator.timeRemaining();\n    setRemain(remain);\n    if (remain === 30) {\n      calc();\n    }\n  };\n  const calc = () => {\n    const newData: DataItem[] = [];\n    keyModel.keys.forEach(key => {\n      newData.push({\n        name: key.name,\n        token: authenticator.generate(key.key),\n      });\n    });\n    setData(newData);\n  };\n  const cp = (text: string) => {\n    copy(text);\n    message.success('复制成功');\n  };\n\n  useEffect(() => {\n    (async () => {\n      await keyModel.getKeys();\n      calc();\n      cron();\n      timer = window.setInterval(cron, 1000);\n    })();\n    return () => {\n      window.clearInterval(timer);\n    };\n  }, []);\n\n  const columns: ColumnsType<DataItem> = [\n    {\n      title: 'Name',\n      dataIndex: 'name',\n    },\n    {\n      title: 'Token',\n      dataIndex: 'token',\n      width: 100,\n      align: 'center',\n    },\n    {\n      key: 'action',\n      title: 'Action',\n      width: 100,\n      align: 'center',\n      render: (value: DataItem, record: DataItem, index: number) => {\n        return <a onClick={() => cp(value.token)}>复制</a>;\n      },\n    },\n  ];\n\n  return (\n    <Row justify=\"center\">\n      <Col style={{ maxWidth: 1000, flexGrow: 1 }}>\n        <Card bodyStyle={{ padding: 8 }} bordered={false}>\n          <Table\n            size=\"middle\"\n            bordered\n            title={() => (\n              <Progress\n                percent={((30 - timeRemain) * 100) / 30}\n                format={() => `${timeRemain}s`}\n              />\n            )}\n            loading={keyModel.loading}\n            columns={columns}\n            dataSource={data}\n            rowKey=\"name\"\n            pagination={false}\n          />\n        </Card>\n      </Col>\n    </Row>\n  );\n}\n\nexport default List;\n","import React, { useRef, useState, useEffect } from 'react';\nimport { Row, Col, Input, Progress, Typography } from 'antd';\nimport { authenticator } from 'otplib';\n\nlet timer = 0;\n\nfunction Calc() {\n  const inputRef = useRef<Input>(null);\n  const [timeRemain, setRemain] = useState(30);\n  const [token, setToken] = useState('000000');\n  useEffect(() => {\n    return () => {\n      window.clearInterval(timer);\n    };\n  }, []);\n  const onPressEnterHandle = () => {\n    window.clearInterval(timer);\n    if (inputRef.current!.input.value) {\n      calc();\n      cron();\n      timer = window.setInterval(cron, 1000);\n    } else {\n      setRemain(30);\n      setToken('000000');\n    }\n  };\n  const cron = () => {\n    const remain = authenticator.timeRemaining();\n    setRemain(remain);\n    if (remain === 30) {\n      calc();\n    }\n  };\n  const calc = () => {\n    setToken(authenticator.generate(inputRef.current!.input.value));\n  };\n  return (\n    <Row justify=\"center\">\n      <Col style={{ marginBottom: 8 }} span={24}>\n        <Input\n          ref={inputRef}\n          placeholder=\"key\"\n          onPressEnter={onPressEnterHandle}\n        />\n      </Col>\n      <Col style={{ marginBottom: 8 }} span={24}>\n        <Progress\n          percent={((30 - timeRemain) * 100) / 30}\n          format={() => `${timeRemain}s`}\n        />\n      </Col>\n      <Col>\n        <Typography.Text copyable>{token}</Typography.Text>\n      </Col>\n    </Row>\n  );\n}\n\nexport default Calc;\n","import React, { useState } from 'react';\nimport { Layout, Row, Col, Typography, Button, Modal } from 'antd';\nimport List from './components/List';\nimport Calc from './components/Calc';\n\nfunction App() {\n  const [showCalc, setShowCalc] = useState(false);\n  return (\n    <Layout>\n      <Layout.Header style={{ padding: '0 16px' }}>\n        <Row style={{ height: '100%' }} justify=\"center\" align=\"middle\">\n          <Col style={{ maxWidth: 1000, flexGrow: 1 }}>\n            <Row justify=\"space-between\" align=\"middle\">\n              <Col>\n                <Typography.Title\n                  style={{ color: '#fff', marginBottom: 0 }}\n                  level={4}\n                >\n                  MFA认证工具\n                </Typography.Title>\n              </Col>\n              <Col>\n                <Button type=\"primary\" onClick={() => setShowCalc(true)}>\n                  计算器\n                </Button>\n              </Col>\n            </Row>\n          </Col>\n        </Row>\n      </Layout.Header>\n      <Layout.Content\n        style={{\n          height: 'calc(100vh - 64px)',\n          padding: 16,\n          overflowY: 'auto',\n        }}\n      >\n        <List />\n      </Layout.Content>\n      <Modal\n        destroyOnClose\n        maskClosable={false}\n        title=\"计算器\"\n        footer={null}\n        visible={showCalc}\n        onCancel={() => setShowCalc(false)}\n      >\n        <Calc />\n      </Modal>\n    </Layout>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { ConfigProvider } from 'antd';\nimport zhCN from 'antd/es/locale/zh_CN';\nimport './models/init';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <ConfigProvider locale={zhCN}>\n    <App />\n  </ConfigProvider>,\n  document.getElementById('root'),\n);\n"],"sourceRoot":""}