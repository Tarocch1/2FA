(this.webpackJsonp2fa=this.webpackJsonp2fa||[]).push([[0],{215:function(e,t,n){e.exports=n(416)},220:function(e,t,n){},302:function(e,t){},304:function(e,t){},337:function(e,t){},338:function(e,t){},416:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"getKeys",(function(){return W}));var r={};n.r(r),n.d(r,"checkToken",(function(){return D})),n.d(r,"getToken",(function(){return F})),n.d(r,"refreshToken",(function(){return H}));var i=n(0),c=n.n(i),o=n(3),l=n.n(o),u=n(16),s=n(213),f=(n(220),n(426)),d=n(419),g=n(420),m=n(421),h=n(425),b=n(82),p=n(28),w=n.n(p),y=n(34),j=n(83),k=n(35),E=(n(137),n(17)),v=n(130),x=n.n(v),O=n(424);function S(e){var t=JSON.parse(window.localStorage.getItem("jwt")||"{}").token||"";return x.a.defaults.headers.common.Token=t,x()(e).then((function(e){return e.data})).catch((function(e){throw O.a.error(e.message),e}))}var I,z,T,R,J,L,C,K,U,A="https://oauth.api.tarocch1.com",N="/login",B="/token",G="/token/check",M="/key",W=function(){return S({method:"get",baseURL:"https://2fa.api.tarocch1.com",url:M})},D=function(){return S({method:"get",baseURL:A,url:G})},F=function(e){return S({method:"post",baseURL:A,url:B,data:{code:e,redirect:"".concat(window.location.origin).concat(window.location.pathname)}})},H=function(){return S({method:"put",baseURL:A,url:B})},P=new(I=function e(){Object(j.a)(this,e),Object(y.a)(this,"keys",z,this),Object(y.a)(this,"loading",T,this),Object(y.a)(this,"getKeys",R,this)},z=Object(k.a)(I.prototype,"keys",[E.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),T=Object(k.a)(I.prototype,"loading",[E.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),R=Object(k.a)(I.prototype,"getKeys",[E.b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){var t;return w.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,w.a.awrap(a.getKeys());case 2:t=n.sent,e.keys=t,e.loading=!1;case 5:case"end":return n.stop()}}))}}}),I),Y=new(J=function e(){Object(j.a)(this,e),Object(y.a)(this,"logged",L,this),Object(y.a)(this,"inited",C,this),Object(y.a)(this,"initAuth",K,this),Object(y.a)(this,"logout",U,this)},L=Object(k.a)(J.prototype,"logged",[E.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),C=Object(k.a)(J.prototype,"inited",[E.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),K=Object(k.a)(J.prototype,"initAuth",[E.b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){var t,n,a,i,c;return w.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,!(t=JSON.parse(window.localStorage.getItem("jwt")||"null"))){o.next=14;break}return o.next=5,w.a.awrap(r.checkToken());case 5:if(!(t.exp-Math.floor(Date.now()/1e3)<=86400)){o.next=10;break}return o.next=8,w.a.awrap(r.refreshToken());case 8:n=o.sent,window.localStorage.setItem("jwt",JSON.stringify(n));case 10:e.logged=!0,e.inited=!0,o.next=27;break;case 14:if(a=new URLSearchParams(window.location.search.replace(/^\?/,"")),!(i=a.get("code"))){o.next=25;break}return o.next=19,w.a.awrap(r.getToken(i));case 19:c=o.sent,window.localStorage.setItem("jwt",JSON.stringify(c)),e.logged=!0,e.inited=!0,o.next=27;break;case 25:e.logged=!1,e.inited=!0;case 27:o.next=33;break;case 29:o.prev=29,o.t0=o.catch(0),e.logged=!1,e.inited=!0;case 33:case"end":return o.stop()}}),null,null,[[0,29]])}}}),U=Object(k.a)(J.prototype,"logout",[E.b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){window.localStorage.removeItem("jwt"),e.logged=!1}}}),J),q=c.a.createContext({keyStore:P,loginStore:Y}),Q=function(){return c.a.useContext(q)},V=n(207),X=n(9);var Z=function(){return c.a.createElement(d.a,{style:{height:"100%"},type:"flex",justify:"center",align:"middle"},c.a.createElement(g.a,null,c.a.createElement(V.a,{indicator:c.a.createElement(X.a,{style:{fontSize:24},type:"loading",spin:!0})})))};var $=function(){return c.a.createElement(d.a,{style:{height:"100%"},type:"flex",justify:"center",align:"middle"},c.a.createElement(g.a,null,c.a.createElement(h.a,{icon:"aliyun",href:"".concat(A).concat(N,"?redirect=").concat(window.location.origin).concat(window.location.pathname)},"\u4f7f\u7528\u963f\u91cc\u4e91\u767b\u5f55")))},_=n(135),ee=n(422),te=n(423),ne=n(133),ae=n(87),re=n.n(ae);var ie=function(){var e=Q().keyStore,t=Object(i.useState)([]),n=Object(_.a)(t,2),a=n[0],r=n[1],o=Object(i.useState)(30),l=Object(_.a)(o,2),u=l[0],s=l[1];Object(i.useEffect)((function(){w.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w.a.awrap(e.getKeys());case 2:m();case 3:case"end":return t.stop()}}))}),[]),Object(i.useEffect)((function(){f();var e=setInterval(f,1e3);return function(){clearInterval(e)}}),[]);var f=function(){var e=ne.authenticator.timeRemaining();s(e),30===e&&m()},m=function(){var t=[];e.keys.forEach((function(e){t.push({name:e.name,token:ne.authenticator.generate(e.key)})})),r(t)};return Object(b.a)((function(){return c.a.createElement(d.a,{type:"flex",justify:"center"},c.a.createElement(g.a,{style:{maxWidth:1e3,flexGrow:1}},c.a.createElement(ee.a,{bordered:!0,itemLayout:"horizontal",loading:e.loading,header:c.a.createElement(te.a,{percent:100*(30-u)/30,format:function(){return"".concat(u,"\u79d2")}}),dataSource:a,renderItem:function(e){return c.a.createElement(ee.a.Item,{actions:[c.a.createElement("a",{key:"copy",onClick:function(){return t=e.token,re()(t),void O.a.success("\u590d\u5236\u6210\u529f");var t}},"\u590d\u5236")]},c.a.createElement(ee.a.Item.Meta,{title:e.name}),c.a.createElement("div",null,e.token))}})))}))};var ce=function(){var e=Q().loginStore;return Object(i.useEffect)((function(){e.initAuth()}),[]),Object(b.a)((function(){return c.a.createElement(f.a,null,c.a.createElement(f.a.Header,{style:{padding:"0 16px"}},c.a.createElement(d.a,{style:{height:"100%"},type:"flex",justify:"center",align:"middle"},c.a.createElement(g.a,{style:{maxWidth:1e3,flexGrow:1,paddingRight:10}},c.a.createElement(d.a,{type:"flex",justify:"space-between",align:"middle"},c.a.createElement(g.a,null,c.a.createElement(m.a.Title,{style:{color:"#fff",marginBottom:0},level:4},"2FA\u8ba4\u8bc1\u5de5\u5177")),c.a.createElement(g.a,null,e.inited&&e.logged&&c.a.createElement(h.a,{type:"danger",onClick:e.logout},"\u9000\u51fa")))))),c.a.createElement(f.a.Content,{style:{height:"calc(100vh - 64px)",padding:16,overflowY:"scroll"}},!e.inited&&c.a.createElement(Z,null),e.inited&&!e.logged&&c.a.createElement($,null),e.inited&&e.logged&&c.a.createElement(ie,null)))}))};l.a.render(c.a.createElement(u.b,{locale:s.a},c.a.createElement(ce,null)),document.getElementById("root"))}},[[215,1,2]]]);
//# sourceMappingURL=main.567525a3.chunk.js.map