(this.webpackJsonpmfa=this.webpackJsonpmfa||[]).push([[0],{287:function(e,t,n){e.exports=n(576)},328:function(e,t,n){},343:function(e,t){},345:function(e,t){},356:function(e,t){},358:function(e,t){},385:function(e,t){},387:function(e,t){},388:function(e,t){},394:function(e,t){},396:function(e,t){},414:function(e,t){},417:function(e,t){},433:function(e,t){},436:function(e,t){},576:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"getKeys",(function(){return S}));var r={};n.r(r),n.d(r,"getToken",(function(){return I})),n.d(r,"checkToken",(function(){return T})),n.d(r,"refreshToken",(function(){return C}));var c=n(0),o=n.n(c),i=n(16),u=n.n(i),l=n(20),s=n(280),f=n(83),d=n(54),m=n.n(d),g=n(84),h=n(135),p=n(136),w=n(284),y=n(181),v=n.n(y);function b(e){var t=JSON.parse(window.localStorage.getItem("jwt")||"{}").token||"";return t&&(v.a.defaults.headers.common.Token=t),v()(e).then((function(e){return e.data})).catch((function(e){return{erred:!0,error:e}}))}var k="https://auth.api.tarocch1.com",E="/login",j="/token",O="/token/check",x="/key",S=function(){return b({method:"get",baseURL:"https://mfa.api.tarocch1.com",url:x})},I=function(){return b({method:"get",baseURL:k,url:j,withCredentials:!0})},T=function(){return b({method:"get",baseURL:k,url:O})},C=function(){return b({method:"put",baseURL:k,url:j})},R=function(){function e(){Object(h.a)(this,e),this.keys=[],this.loading=!0}return Object(p.a)(e,[{key:"getKeys",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getKeys();case 2:(t=e.sent).erred?w.b.error("\u83b7\u53d6\u5bc6\u94a5\u5931\u8d25"):this.keys=t,this.loading=!1;case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),J=function(){function e(){Object(h.a)(this,e),this.logged=!1,this.inited=!1}return Object(p.a)(e,[{key:"setLogged",value:function(e){this.logged=e}},{key:"initAuth",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!JSON.parse(window.localStorage.getItem("jwt")||"null")){e.next=8;break}return e.next=4,r.checkToken();case 4:e.sent.erred?(w.b.error("\u9a8c\u8bc1token\u5931\u8d25"),window.localStorage.removeItem("jwt")):(this.refreshToken(),this.logged=!0),e.next=12;break;case 8:return e.next=10,r.getToken();case 10:(t=e.sent).erred||(window.localStorage.setItem("jwt",JSON.stringify(t)),this.logged=!0);case 12:this.inited=!0;case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshToken",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(JSON.parse(window.localStorage.getItem("jwt")).payload.exp-Math.floor(Date.now()/1e3)<=86400)){e.next=6;break}return e.next=4,r.refreshToken();case 4:t=e.sent,window.localStorage.setItem("jwt",JSON.stringify(t));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"logout",value:function(){window.localStorage.removeItem("jwt"),this.logged=!1}}]),e}();Object(f.a)(R),Object(f.a)(J);n(328);var N=n(79),K=n(578),L=n(105),A=n(56),B=n(581),U=n(42),z=n(582),F=n(258),G=n(584);var M=function(){return o.a.createElement(L.a,{style:{height:"100%"},justify:"center",align:"middle"},o.a.createElement(A.a,null,o.a.createElement(F.a,{indicator:o.a.createElement(G.a,{style:{fontSize:24}})})))},W=n(585);var D=function(){return o.a.createElement(L.a,{style:{height:"100%"},justify:"center",align:"middle"},o.a.createElement(A.a,null,o.a.createElement(W.a,{status:"403",title:"403",extra:o.a.createElement(U.a,{type:"primary",onClick:function(){window.location.assign("".concat(k).concat(E,"?redirect=").concat(window.location.href))}},"\u767b\u5f55")})))},H=n(580),P=n(579),Y=n(583),q=n(103),Q=n(144),V=n.n(Q),X=0;var Z=function(){var e=Object(f.b)(R),t=Object(c.useState)([]),n=Object(N.a)(t,2),a=n[0],r=n[1],i=Object(c.useState)(30),u=Object(N.a)(i,2),l=u[0],s=u[1],d=function(){var e=q.authenticator.timeRemaining();s(e),30===e&&h()},h=function(){var t=[];e.keys.forEach((function(e){t.push({name:e.name,token:q.authenticator.generate(e.key)})})),r(t)};Object(c.useEffect)((function(){return Object(g.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getKeys();case 2:h(),d(),X=window.setInterval(d,1e3);case 5:case"end":return t.stop()}}),t)})))(),function(){window.clearInterval(X)}}),[]);var p=[{title:"Name",dataIndex:"name"},{title:"Token",dataIndex:"token",width:100,align:"center"},{key:"action",title:"Action",width:100,align:"center",render:function(e,t,n){return o.a.createElement("a",{onClick:function(){return t=e.token,V()(t),void w.b.success("\u590d\u5236\u6210\u529f");var t}},"\u590d\u5236")}}];return o.a.createElement(L.a,{justify:"center"},o.a.createElement(A.a,{style:{maxWidth:1e3,flexGrow:1}},o.a.createElement(H.a,{bodyStyle:{padding:8},bordered:!1},o.a.createElement(P.a,{size:"middle",bordered:!0,title:function(){return o.a.createElement(Y.a,{percent:100*(30-l)/30,format:function(){return"".concat(l,"s")}})},loading:e.loading,columns:p,dataSource:a,rowKey:"name",pagination:!1}))))},$=n(586),_=0;var ee=function(){var e=Object(c.useRef)(null),t=Object(c.useState)(30),n=Object(N.a)(t,2),a=n[0],r=n[1],i=Object(c.useState)("000000"),u=Object(N.a)(i,2),l=u[0],s=u[1];Object(c.useEffect)((function(){return function(){window.clearInterval(_)}}),[]);var f=function(){var e=q.authenticator.timeRemaining();r(e),30===e&&d()},d=function(){s(q.authenticator.generate(e.current.input.value))};return o.a.createElement(L.a,{justify:"center"},o.a.createElement(A.a,{style:{marginBottom:8},span:24},o.a.createElement($.a,{ref:e,placeholder:"key",onPressEnter:function(){window.clearInterval(_),e.current.input.value?(d(),f(),_=window.setInterval(f,1e3)):(r(30),s("000000"))}})),o.a.createElement(A.a,{style:{marginBottom:8},span:24},o.a.createElement(Y.a,{percent:100*(30-a)/30,format:function(){return"".concat(a,"\u79d2")}})),o.a.createElement(A.a,null,o.a.createElement(B.a.Text,{copyable:!0},l)))};var te=function(){var e=Object(f.b)(J),t=Object(c.useState)(!1),n=Object(N.a)(t,2),a=n[0],r=n[1];return Object(c.useEffect)((function(){e.initAuth()}),[]),o.a.createElement(K.a,null,o.a.createElement(K.a.Header,{style:{padding:"0 16px"}},o.a.createElement(L.a,{style:{height:"100%"},justify:"center",align:"middle"},o.a.createElement(A.a,{style:{maxWidth:1e3,flexGrow:1,paddingRight:10}},o.a.createElement(L.a,{justify:"space-between",align:"middle"},o.a.createElement(A.a,null,o.a.createElement(B.a.Title,{style:{color:"#fff",marginBottom:0},level:4},"MFA\u8ba4\u8bc1\u5de5\u5177")),o.a.createElement(A.a,null,e.inited&&e.logged&&o.a.createElement(o.a.Fragment,null,o.a.createElement(U.a,{style:{marginRight:8},type:"primary",onClick:function(){return r(!0)}},"\u8ba1\u7b97\u5668"),o.a.createElement(U.a,{type:"primary",danger:!0,onClick:e.logout},"\u9000\u51fa"))))))),o.a.createElement(K.a.Content,{style:{height:"calc(100vh - 64px)",padding:16,overflowY:"auto"}},!e.inited&&o.a.createElement(M,null),e.inited&&!e.logged&&o.a.createElement(D,null),e.inited&&e.logged&&o.a.createElement(Z,null)),o.a.createElement(z.a,{destroyOnClose:!0,maskClosable:!1,title:"\u8ba1\u7b97\u5668",footer:null,visible:a,onCancel:function(){return r(!1)}},o.a.createElement(ee,null)))};u.a.render(o.a.createElement(l.b,{locale:s.a},o.a.createElement(te,null)),document.getElementById("root"))}},[[287,1,2]]]);
//# sourceMappingURL=main.6aec3cbb.chunk.js.map